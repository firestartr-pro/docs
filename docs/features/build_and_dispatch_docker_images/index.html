<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Build and dispatch workflows# This feature is a collection of seven workflows (along with their configuration files), which when used in conjunction allow a user to build final docker images from a release tag, or snapshot images, from a pre-release tag, or commit SHA; Once the images are built, the make_dispatches workflow dispatches the image update automatically to their respective state repositories. They can be thought of as two different but closely related features.
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://docs.firestartr.dev/docs/features/build_and_dispatch_docker_images/"><meta property="og:site_name" content="Firestartr Documentation"><meta property="og:title" content="Firestartr Documentation"><meta property="og:description" content="Build and dispatch workflows# This feature is a collection of seven workflows (along with their configuration files), which when used in conjunction allow a user to build final docker images from a release tag, or snapshot images, from a pre-release tag, or commit SHA; Once the images are built, the make_dispatches workflow dispatches the image update automatically to their respective state repositories. They can be thought of as two different but closely related features."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Firestartr Documentation"><meta itemprop=description content="Build and dispatch workflows# This feature is a collection of seven workflows (along with their configuration files), which when used in conjunction allow a user to build final docker images from a release tag, or snapshot images, from a pre-release tag, or commit SHA; Once the images are built, the make_dispatches workflow dispatches the image update automatically to their respective state repositories. They can be thought of as two different but closely related features."><meta itemprop=wordCount content="2812"><title>Build and Dispatch Docker Images | Firestartr Documentation</title><link rel=icon href=/docs/favicon.png><link rel=manifest href=/docs/manifest.json><link rel=canonical href=https://docs.firestartr.dev/docs/features/build_and_dispatch_docker_images/><link rel=stylesheet href=/docs/book.min.cc2c524ed250aac81b23d1f4af87344917b325208841feca0968fe450f570575.css integrity="sha256-zCxSTtJQqsgbI9H0r4c0SRezJSCIQf7KCWj+RQ9XBXU=" crossorigin=anonymous><script defer src=/docs/fuse.min.js></script><script defer src=/docs/en.search.min.27ea268489c4afe5460ac64c12852404231f9abe51a238c074a89899891f1487.js integrity="sha256-J+omhInEr+VGCsZMEoUkBCMfmr5RojjAdKiYmYkfFIc=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=https://docs.firestartr.dev/docs/features/build_and_dispatch_docker_images/index.xml title="Firestartr Documentation"></head><body dir=ltr class="book-kind-section book-type-features"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/docs/><span>Firestartr Documentation</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/Migrating-to-our-new-app-state-repo-structure/>Migrating to Our New App State Repo Structure</a></li><li><input type=checkbox id=section-77ba58481c81cfcc87f14a72108199d0 class=toggle>
<label for=section-77ba58481c81cfcc87f14a72108199d0 class=flex><a href=/docs/providers/>Providers</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><input type=checkbox id=section-b1b6ec47a00c93e67ba6b7835cfc5cbb class=toggle>
<label for=section-b1b6ec47a00c93e67ba6b7835cfc5cbb class=flex><a href=/docs/providers/terraform/>Terraform</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/providers/terraform/workspace-policies/>Workspace Policies</a></li><li><a href=/docs/providers/terraform/workspace-sync/>Workspace Sync</a></li></ul></li></ul></li><li><a href=/docs/state-apps-repository/>State Apps Repository</a></li><li><a href=/docs/state-sys-services-repository/>State Sys Services Repository</a></li><li><a href=/docs/The-dot-firestartr-repository/>The Dot Firestartr Repository</a></li><li><a href=/docs/Validating-our-claims/>Validating Our Claims</a></li><li><input type=checkbox id=section-59625c6804349fe2bfba21980f88c1e3 class=toggle checked>
<label for=section-59625c6804349fe2bfba21980f88c1e3 class=flex><a href=/docs/features/>Features</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><input type=checkbox id=section-175a6acb21b23225ad6bb7d217c9122e class=toggle checked>
<label for=section-175a6acb21b23225ad6bb7d217c9122e class=flex><a href=/docs/features/build_and_dispatch_docker_images/ class=active>Build and Dispatch Docker Images</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/build_and_dispatch_docker_images/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-39ffb35bc31c80c3835fb6d107d8f566 class=toggle>
<label for=section-39ffb35bc31c80c3835fb6d107d8f566 class=flex><a href=/docs/features/catalog_repo/>Catalog Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/catalog_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-6b57e3023d9f976a9384af45ac1defa0 class=toggle>
<label for=section-6b57e3023d9f976a9384af45ac1defa0 class=flex><a href=/docs/features/charts_repo/>Charts Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/charts_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-b6a186066fe5df06a19368fd8c4e2996 class=toggle>
<label for=section-b6a186066fe5df06a19368fd8c4e2996 class=flex><a href=/docs/features/claims_repo/>Claims Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/claims_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-38807a9873b684081175bcfa2c2cf899 class=toggle>
<label for=section-38807a9873b684081175bcfa2c2cf899 class=flex><a href=/docs/features/features_repo/>Features Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/features_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-b095c0174f431275dbfbd179b858882c class=toggle>
<label for=section-b095c0174f431275dbfbd179b858882c class=flex><a href=/docs/features/firestartr_repo/>Firestartr Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/firestartr_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-8c74538169d2bfcc42048e94a7a8b10f class=toggle>
<label for=section-8c74538169d2bfcc42048e94a7a8b10f class=flex><a href=/docs/features/issue_templates/>Issue Templates</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/issue_templates/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-356bba00636a6fa9c561ac1523b4c383 class=toggle>
<label for=section-356bba00636a6fa9c561ac1523b4c383 class=flex><a href=/docs/features/release_please/>Release Please</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/release_please/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-17190a34986f329bfce42d3c100d77a8 class=toggle>
<label for=section-17190a34986f329bfce42d3c100d77a8 class=flex><a href=/docs/features/state_github/>State Github</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/state_github/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-5f9553708125dcb2260eaa1dc68fa4b3 class=toggle>
<label for=section-5f9553708125dcb2260eaa1dc68fa4b3 class=flex><a href=/docs/features/state_infra/>State Infra</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/state_infra/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-5cfdf617da323132dc220c8cdac15345 class=toggle>
<label for=section-5cfdf617da323132dc220c8cdac15345 class=flex><a href=/docs/features/state_repo/>State Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/state_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-ed9c88a7368e2738f3eb675492c08586 class=toggle>
<label for=section-ed9c88a7368e2738f3eb675492c08586 class=flex><a href=/docs/features/state_repo_apps/>State Repo Apps</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/state_repo_apps/KUBERNETES_README/>Kubernetes Readme</a></li><li><a href=/docs/features/state_repo_apps/SECRETS_README/>Secrets Readme</a></li><li><a href=/docs/features/state_repo_apps/TFWORKSPACES_README/>Tfworkspaces Readme</a></li><li><a href=/docs/features/state_repo_apps/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-9b5377154045b7f8613471f4d8281e78 class=toggle>
<label for=section-9b5377154045b7f8613471f4d8281e78 class=flex><a href=/docs/features/state_repo_sys_services/>State Repo Sys Services</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/state_repo_sys_services/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-36ec9bd0ed3955d6fa86995304f3f940 class=toggle>
<label for=section-36ec9bd0ed3955d6fa86995304f3f940 class=flex><a href=/docs/features/tech_docs/>Tech Docs</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/tech_docs/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-85da29a6eded009fe28c389b53dac15e class=toggle>
<label for=section-85da29a6eded009fe28c389b53dac15e class=flex><a href=/docs/features/terraform-infra/>Terraform Infra</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/terraform-infra/ACCOUNTS_README/>Accounts Readme</a></li><li><a href=/docs/features/terraform-infra/CHANGELOG/>Changelog</a></li></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/docs/icons/menu.svg class=book-icon alt=Menu></label><h3>Build and Dispatch Docker Images</h3><label for=toc-control><img src=/docs/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#build-images>Build images</a><ul><li></li></ul></li><li><a href=#make-dispatches>Make dispatches</a><ul><li></li></ul></li><li><a href=#feature-arguments>Feature arguments</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=build-and-dispatch-workflows>Build and dispatch workflows<a class=anchor href=#build-and-dispatch-workflows>#</a></h1><p>This feature is a collection of seven workflows (along with their configuration files), which when used in conjunction allow a user to build final docker images from a release tag, or snapshot images, from a pre-release tag, or commit SHA; Once the images are built, the <code>make_dispatches</code> workflow dispatches the image update automatically to their respective state repositories. They can be thought of as two different but closely related features.</p><p>The workflows <code>trigger_dispatch_on_releases.yaml</code>, <code>trigger_dispatch_on_pre-releases.yaml</code> and <code>trigger_dispatch_on_snapshot.yaml</code> only serve to trigger <code>make_dispatches.yaml</code> after a successful automated call to any of the <code>build_docker_&lt;type>.yaml</code> workflows. They require no other explanation so they won&rsquo;t be discussed in this README</p><h2 id=build-images>Build images<a class=anchor href=#build-images>#</a></h2><p>Composed of the workflows <code>.github/workflows/build_docker_releases.yaml</code>, <code>.github/workflows/build_docker_pre-releases.yaml</code> and <code>.github/workflows/build_docker_snapshots.yaml</code>.</p><h4 id=configuration>Configuration<a class=anchor href=#configuration>#</a></h4><p>All build workflows use the same configuration file located at <code>.github/build_images.yaml</code>. Its format is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>snapshots</span>:  <span style=color:#75715e># Configuration specific for snapshots, used by build_docker_pre-releases and build_docker_snapshots</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>flavor</span>:  <span style=color:#75715e># Flavor-specific configuration. A flavor can be named anything as long as it&#39;s a valid YAML key</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>path/to/dockerfile </span> <span style=color:#75715e># Path relative to the repo root folder</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>auto</span>: <span style=color:#66d9ef>false</span>  <span style=color:#75715e># Whether or not to automatically build this flavor when the * input is specified (see &#34;Inputs&#34; below). Defaults to false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>build_args</span>:  <span style=color:#75715e># Environment variables to set during the image building process</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#  ENV_VARIABLE_NAME: env_variable_value</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>API_URL</span>: <span style=color:#ae81ff>https://api.com/url</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>UI_COLOR</span>: <span style=color:#e6db74>&#39;#125690&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>extra_registries</span>:  <span style=color:#75715e># List of registries, other than the default one (see &#34;Defaults&#34; below), where to upload the image</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>registry.azure.io</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>service/repo</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>auth_strategy</span>: <span style=color:#ae81ff>azure_oidc</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Multiple kinds of registries can be specified</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws.amazon.com</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>programs/program-name </span> <span style=color:#75715e># Repository names can be different between registries</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>auth_strategy</span>: <span style=color:#ae81ff>aws_oidc </span> <span style=color:#75715e># Multiple auth strategies should be supported but they currently aren&#39;t</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>extra_tags</span>: <span style=color:#75715e># List of extra tags to publish the image as</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>latest</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>stable</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>platforms</span>:  <span style=color:#75715e># List of platforms for which to build the image. If unspecified, the image will be built for linux/amd64 only</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Only linux/amd64 and linux/arm64 are currently supported</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>linux/amd64</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>linux/arm64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>another-flavor</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>path/to/dockerfile</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>registry</span>:  <span style=color:#75715e># The default registry can be overridden (see &#34;Defaults&#34; below)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nondefault.registry.es</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>nondefault/repo</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>auth_strategy</span>: <span style=color:#ae81ff>azure_oidc </span> <span style=color:#75715e># Can be any of azure_oidc or aws_oidc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>releases</span>:  <span style=color:#75715e># Configuration specific for releases, used by build_docker_releases</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>release-flavor</span>:
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>... </span> <span style=color:#75715e># The same configuration parameters as snapshots can be used here</span></span></span></code></pre></div><ul><li><code>snapshots</code>: all image flavors included within this key will count as a snapshot flavor, and thus will be built when the <code>build_docker_snapshots</code> or <code>build_docker_pre-releases</code> workflows are executed</li><li><code>releases</code>: all image flavors included within this key will count as a release flavor, and thus will be built when the <code>build_docker_releases</code> workflow is executed</li></ul><p>Inside each of these two keys (<code>type</code> keys) there will be one or more flavor keys:</p><ul><li><code>&lt;flavor></code>: the name of the flavor to build. Will be appended to the end of the final image tag. The same flavor name cannot be duplicated inside the same <code>type</code> key, but it can be in both <code>type</code> keys at the same time (i.e. <code>snapshots</code> cannot contain two <code>default</code> flavor keys, but both <code>snapshots</code> and <code>releases</code> can contain a single <code>default</code> key at the same time)</li></ul><p>Each flavor key can contain:</p><ul><li><code>dockerfile</code>: path to the dockerfile to use when building this image, relative to the repo root (i.e. if the dockerfile is located at <code>https://www.github.com/firestartr-test/code-repo/docker/Dockerfile</code>, this keys&rsquo; value will be <code>docker/Dockerfile</code>)</li><li><code>auto</code>: whether or not to build this flavor when the <a href=#inputs><code>flavors</code> input</a> equals *. <a href=#defaults>Defaults to false</a></li><li><code>build_args</code>: key-value pairs that are set as environment variables when building the image. The key is the environment value name, and the value its value, and any number of them can be specified.</li><li><code>registry</code>: a <a href=#registry-objects><code>registry</code> object</a> that overrides the <a href=#defaults>default registry</a>. If this key is specified, <em><strong>no image will be uploaded to the <a href=#defaults>default registry</a></strong></em></li><li><code>extra_registries</code>: a list of <a href=#registry-objects><code>registry</code> object</a> to where the image will be uploaded to, in addition to the <a href=#defaults>default registry</a>. If this key is specified, <em><strong>the image will still be uploaded to the <a href=#defaults>default registry</a></strong></em></li><li><code>extra_tags</code>: optional list of strings representing extra tags to publish the image as. While the default tag is constructed as <code>&lt;flavor>_&lt;version></code>, no extra info will be appended to these tags. E.g. if the flavor is <code>default</code> and the version is <code>v1.2.3</code>, the default tag will be <code>default_v1.2.3</code>, and if <code>latest</code> is specified as an extra tag, the image will also be tagged as <code>latest</code>. For this reason, all values listed as <code>extra_tags</code> must be unique across all flavors and types (i.e., two different flavors cannot both have <code>latest</code> as an extra tag, even if one is a snapshot and the other a release)</li><li><code>platforms</code>: optional list of strings representing platforms for which to build the image. If unspecified, the image will be built for <code>linux/amd64</code> only. Currently, only <code>linux/amd64</code> and <code>linux/arm64</code> are supported. If specified, the image will be built only for the platform(s) listed.</li></ul><h4 id=registry-objects>Registry objects<a class=anchor href=#registry-objects>#</a></h4><p>A registry object contains the following keys:</p><ul><li><code>name</code>: base URL of the registry. E.g. when uploading a image to <code>registry.com/image_repo/image_tag</code>, this key&rsquo;s value should be <code>registry.com</code></li><li><code>repository</code>: name of the repository inside of the registry <code>name</code> to where upload the image to. E.g. when uploading a image to <code>registry.com/image_repo/image_tag</code>, this key&rsquo;s value should be <code>image_repo</code></li><li><code>auth_strategy</code>: type of authentication to use for login, as different registries require different authentication methods. Though many are defined, currently only <code>azure_oidc</code> and <code>aws_oidc</code> are supported</li></ul><h4 id=inputs>Inputs<a class=anchor href=#inputs>#</a></h4><p>All build workflows use the same inputs. They are:</p><ul><li><code>from</code>: point of the code history from which the image will be built. Can be a short or long commit SHA, a branch name or a tag name</li><li><code>flavors</code>: which flavors to build. Each workflow will only look for flavors in their respective section (i.e., build_docker_releases will only build flavors from <code>releases</code>, while the other two will only build flavors from <code>snapshots</code>). Can be a single flavor, a list of comma separated flavors (spaces are trimmed) or *. * builds all flavors that are set as auto in <code>build_images.yaml</code> (see <a href=#configuration>Configuration</a>)</li></ul><h4 id=defaults>Defaults<a class=anchor href=#defaults>#</a></h4><p>All build workflows use the same defaults. There are two types of defaults: environment variables and defaults defined by code. The environment variables are:</p><ul><li><code>DOCKER_REGISTRY_RELEASES</code>: base URL of the Docker registry for releases. Follows the same format as <code>extra_registries.name</code> and <code>registry.name</code> (e.g. <code>prefapp.azureacr.io</code>. See <a href=#configuration>Configuration</a>)</li><li><code>DOCKER_REGISTRY_SNAPSHOTS</code>: base URL of the Docker registry for snapshots. Follows the same format as <code>extra_registries.name</code> and <code>registry.name</code> (e.g. <code>prefapp.azureacr.io</code>. See <a href=#configuration>Configuration</a>)</li></ul><p>The defaults defined by code are:</p><ul><li><code>registry.repository</code> defaults to the name of the repo the workflow is being executed on, including the owner. E.g. <code>prefapp/test-repo-rundagger</code></li><li><code>flavor.auto</code> defaults to <code>false</code></li></ul><h2 id=make-dispatches>Make dispatches<a class=anchor href=#make-dispatches>#</a></h2><p>Composed of the workflow <code>.github/workflows/make_dispatches.yaml</code>.</p><h4 id=configuration-1>Configuration<a class=anchor href=#configuration-1>#</a></h4><p>The <code>make_dispatches</code> workflow uses the configuration file located at <code>.github/make_dispatches.yaml</code>. Its format is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>deployments</span>:  <span style=color:#75715e># Has a list of configurations</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>tenant</span>: <span style=color:#ae81ff>prefapp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>az-cluster </span> <span style=color:#75715e># Platform where we want to dispatch changes to</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>snapshots </span> <span style=color:#75715e># Either snapshots or releases</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>flavor</span>: <span style=color:#ae81ff>flavor1 </span> <span style=color:#75715e># Flavor to dispatch for this deployment. Must have the same name as a flavor defined in build_images.yaml, under the chosen type (see &#34;Build images -&gt; Configuration&#34; above)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>$branch_dev </span> <span style=color:#75715e># See &#34;About the version field&#34; below</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>registry</span>: <span style=color:#ae81ff>prefapp.azureacr.io </span> <span style=color:#75715e># Optional. Registry where the image was uploaded to (see &#34;Defaults&#34; below)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image_repository</span>: <span style=color:#ae81ff>service/test-repo </span> <span style=color:#75715e># Optional. Repo where the image was uploaded to (see &#34;Defaults&#34; below)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>base_path</span>: <span style=color:#ae81ff>apps </span> <span style=color:#75715e># Can be left empty or unspecified</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>application</span>: <span style=color:#ae81ff>test-repo-rundagger</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env</span>: <span style=color:#ae81ff>dev</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># You can specify one of the following</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service_names</span>: [<span style=color:#e6db74>&#39;test-repo-service&#39;</span>]  <span style=color:#75715e># List, multiple services can be specified</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># OR</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image_keys</span>: [<span style=color:#e6db74>&#39;/test-repo-service/image&#39;</span>]  <span style=color:#75715e># List, multiple image keys can be specified</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># So, in this example github.com/prefapp/prefapp-state/apps/&lt;platform-type&gt;/az-cluster/prefapp/test-repo-rundagger/dev would be updated when making this dispatch</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># An entry is created for each tenant - platform - type - flavor combination we want to dispatch</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>tenant</span>: <span style=color:#ae81ff>prefapp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>az-cluster</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>snapshots</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>flavor</span>: <span style=color:#ae81ff>another-flavor</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>tenant</span>: <span style=color:#ae81ff>prefapp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>aks-cluster</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>snapshots</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>flavor</span>: <span style=color:#ae81ff>flavor1</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span></span></span></code></pre></div><ul><li><code>deployments</code>: contains the list of deployments to dispatch. Has no special data or meaning but must be specified for the dispatch workflow to work</li></ul><p>Each deployment contains:</p><ul><li><code>tenant</code>: name of the tenant that will be used for this deployment. Used to determine which file to update when dispatching, and also for validation: the tenant must be specified in the list of valid tenants in the platform configuration of the <code>.firestartr</code> repo</li><li><code>platform</code>: name of the platform that will be used for this deployment. Used to determine which file to update when dispatching, and also for validation: the specified platform must have an associated configuration file. From the platform configuration file, it&rsquo;s <code>type</code> will also be used when determining which file to update.</li><li><code>type</code>: deployment type, can be either of <code>snapshots</code> or <code>releases</code>. Used when calling the dispatch workflow to filter which dispatches to make.</li><li><code>flavor</code>: name of the flavor that will be used for this deployment. Used to compose the image tag, which will be written to the corresponding deployment files and must have been built beforehand.</li><li><code>version</code>: version of the code used in the image. Used to compose the image tag, which will be written to the corresponding deployment manifests and must have been built beforehand. See <a href=#about-the-version-field>About the version field</a> for more info on the possible values this parameter could have.</li><li><code>registry</code>: registry to where the image has been uploaded to. This parameter is optional, and the registry specified in either the <code>DOCKER_REGISTRY_RELEASES</code> and <code>DOCKER_REGISTRY_SNAPSHOTS</code> variables will be used by default (see <a href=#defaults-1>Defaults</a>).</li><li><code>image_repository</code>: repository to where the image has been uploaded to. This parameter is optional, and the repository specified in the application configuration will be used by default.</li><li><code>base_path</code>: legacy parameter. Appends this value to the deployment path, so that the final result ends like: <code>&lt;base_path>/&lt;platform-type>/&lt;platform>/&lt;tenant>/&lt;env></code>. Should only be used when dispatching to an old state repository.</li><li><code>application</code>: name of the application that will be dispatched. Used for validation, as a valid configuration must exist for the application, and to get the default state and image repo.</li><li><code>env</code>: environment where to deploy to. Could technically be any string, but usually is one of <code>dev</code>, <code>pre</code> or <code>pro</code>. Must be a value included in the <code>registry</code> configuration file.</li><li><code>service_names</code>: names of the services this deployment will be dispatched to. These values will be validated against the application configuration in the <code>.firestartr</code> repo: each value of this field must be included within the <code>service_names</code> of the current repository for this deployment&rsquo;s application. Cannot be used at the same time as the <code>image_keys</code> parameter.</li><li><code>image_keys</code>: list of JSONPatch paths to patch the deployment YAMLs. These values aren&rsquo;t validated against any configuration file. Cannot be used at the same time as the <code>service_names</code> parameter.</li></ul><h4 id=workflow-inputs>Workflow inputs<a class=anchor href=#workflow-inputs>#</a></h4><ul><li><code>image_type</code>: which types of images to build. Can be <code>releases</code>, <code>snapshots</code> (default) or <code>*</code> (both)</li><li><code>flavors</code>: which flavors to dispatch. Will only look for flavors inside <code>image_type</code>. Can be a single flavor, a list of comma separated flavors (spaces are trimmed) or <code>*</code>. <code>*</code> builds all flavors that are set as auto in <code>build_images.yaml</code> (see <a href=#configuration>Build Images -> Configuration</a>)</li><li><code>overwrite_version</code>: instead of using <code>version</code>, the value of this input will be used for each <code>image_type</code> and <code>flavors</code> if specified. Can be any of the valid <code>make_dispatches.yaml</code> configuration keywords (see <a href=#about-the-version-field>About the version field</a>)</li><li><code>overwrite_tenant</code>: instead of using <code>tenant</code>, the value of this input will be used for each <code>image_type</code> and <code>flavors</code> if specified.</li><li><code>overwrite_env</code>: instead of using <code>env</code>, the value of this input will be used for each <code>image_type</code> and <code>flavors</code> if specified.</li><li><code>filter_by_tenant</code>: only dispatch to the <code>tenant</code> specified by this input. These tenants must already have an entry in <code>make_dispatches.yaml</code> for <code>image_type</code> and <code>flavors</code> (i.e. this filter won&rsquo;t do anything if the <code>flavors</code> of <code>image_type</code> could not be dispatched to <code>filter_by_tenant</code> to begin with). Can be a single tenant, a list of comma separated tenants (spaces are trimmed) or <code>*</code> (all tenants for a given <code>image_type</code> and <code>flavors</code>)</li><li><code>filter_by_env</code>: only dispatch to the <code>env</code> specified by this input. These envs must already have an entry in <code>make_dispatches.yaml</code> for <code>image_type</code> and <code>flavors</code> (i.e. this filter won&rsquo;t do anything if the <code>flavors</code> of <code>image_type</code> could not be dispatched to <code>filter_by_env</code> to begin with). Can be a single env, a list of comma separated envs (spaces are trimmed) or <code>*</code> (all envs for a given <code>image_type</code> and <code>flavors</code>)</li><li><code>filter_by_platform</code>: only dispatch to the <code>platform</code> specified by this input. These platforms must already have an entry in <code>make_dispatches.yaml</code> for <code>image_type</code> and <code>flavors</code> (i.e. this filter won&rsquo;t do anything if the <code>flavors</code> of <code>image_type</code> could not be dispatched to <code>filter_by_platform</code> to begin with). Can be a single platform, a list of comma separated platforms (spaces are trimmed) or <code>*</code> (all platforms for a given <code>image_type</code> and <code>flavors</code>)</li><li><code>workflow_run_id</code>: the workflow needs the build summary of the last <code>build_docker_&lt;type></code>. If you have access to it, you can give it as an input here. If left blank, it will be automatically calculated by the workflow</li></ul><h4 id=defaults-1>Defaults<a class=anchor href=#defaults-1>#</a></h4><p>The defaults are defined as environment variables and are:</p><ul><li><code>DOCKER_REGISTRY_RELEASES</code>: base URL of the Docker registry for releases. Follows the same format as <code>extra_registries.name</code> and <code>registry.name</code> (e.g. <code>prefapp.azureacr.io</code>. See <a href=#configuration>Build Images -> Configuration</a>)</li><li><code>DOCKER_REGISTRY_SNAPSHOTS</code>: base URL of the Docker registry for snapshots. Follows the same format as <code>extra_registries.name</code> and <code>registry.name</code> (e.g. <code>prefapp.azureacr.io</code>. See <a href=#configuration>Build Images -> Configuration</a>)</li></ul><h4 id=about-the-version-field>About the <code>version</code> field<a class=anchor href=#about-the-version-field>#</a></h4><p>Specifies which image to dispatch. Can have any of the following values:</p><ul><li><code>$latest_release</code>: the latest available release</li><li><code>$latest_prerelease</code>: the latest available prerelease</li><li><code>$branch_&lt;branch_name></code>: the latest available image associated to <code>&lt;branch_name></code></li><li>Any commit SHA (both short and long) or tag: the latest available image associated to the input</li></ul><h4 id=about-the-trigger-deployment-workflow>About the <code>Trigger deployment</code> workflow<a class=anchor href=#about-the-trigger-deployment-workflow>#</a></h4><p>A second workflow, <code>Trigger deployment</code> (with filename <code>trigger_deployment.yaml</code>), is also included. This is a simplified version of the more complex <code>make_dispatches</code> workflow, and is meant to be used by users who want to trigger simple deployments, to a specific <code>tenant</code>, <code>platform</code> and <code>env</code>. Its inputs are:</p><ul><li><code>flavor</code>: which flavor to dispatch. Contrary to the normal <code>make_dispatches</code> workflow, only a single flavor can be specified here, and it will also dictate the <code>image_type</code> (i.e., if the flavor exists in <code>snapshots</code>, the image type will be <code>snapshots</code>, and the same for <code>releases</code>. If it exists in both, <code>*</code> will be used). Defaults to <code>default</code></li><li><code>version</code>: equivalent to the <code>overwrite_version</code> input of the normal <code>make_dispatches</code> workflow, with one notable difference: if the value is left empty, <code>$latest_release</code> will be used</li><li><code>tenant</code>: equivalent to the <code>filter_by_tenant</code> input of the normal <code>make_dispatches</code> workflow. Mandatory</li><li><code>platform</code>: equivalent to the <code>filter_by_platform</code> input of the normal <code>make_dispatches</code> workflow. Mandatory</li><li><code>env</code>: equivalent to the <code>filter_by_env</code> input of the normal <code>make_dispatches</code> workflow. Mandatory</li></ul><p>For ease of use, the <code>tenant</code>, <code>platform</code> and <code>env</code> inputs have been made into choice dropdowns, populated from the configuration files in the <code>.firestartr</code> repository. This population is done automatically via the <code>update-features-with-dot-firestartr-info.yaml</code> workflow from the <a href=https://docs.firestartr.dev/docs/features/#-claims-repo><code>claims_repo</code> feature</a>. When this feature is installed for the first time, it&rsquo;s needed to either launch that workflow manually or wait until it automatically runs at midnight UTC, so that the dropdowns get populated with the correct values.</p><h2 id=feature-arguments>Feature arguments<a class=anchor href=#feature-arguments>#</a></h2><ul><li><code>build_snapshots_branch</code>: which branch triggers an automatic snapshot build when pushed to. Defaults to the default branch of the repository, specified under <code>providers.github.branchStrategy.defaultBranch</code> inside the claim (usually <code>main</code> or <code>master</code>)</li><li><code>auth_strategy</code>: which authentication strategy to use when logging into the docker registries. Defaults to <code>azure_oidc</code></li><li><code>build_snapshots_filter</code>: filter to apply when automatically building snapshot images. Defaults to an empty string (no filter)</li><li><code>build_pre_releases_filter</code>: filter to apply when automatically building pre-release images. Defaults to an empty string (no filter)</li><li><code>build_releases_filter</code>: filter to apply when automatically building release images. Defaults to an empty string (no filter)</li><li><code>default_snapshots_flavors_filter</code>: default filter shown in the UI when manually executing the build snapshots workflow. Defaults to <code>*</code></li><li><code>default_pre_releases_flavors_filter</code>: default filter shown in the UI when manually executing the build pre-releases workflow. Defaults to <code>*</code></li><li><code>default_releases_flavors_filter</code>: default filter shown in the UI when manually executing the build releases workflow. Defaults to <code>*</code></li><li><code>firestartr_config_repo</code>: name of the repository that houses all the config files used by the <code>make_dispatches</code> workflow. Defaults to <code>${{ github.repository_owner }}/.firestartr</code></li><li><code>make_dispatches_config_file_path</code>: path to the <code>make_dispatches</code> config file to be used by the <code>make_dispatches</code> workflow, relative to the root of the repository. Defaults to <code>.github/make_dispatches.yaml</code></li><li><code>apps_folder_path</code>: path to the <code>apps</code> folder to be used by the <code>make_dispatches</code> workflow. This is a path local to the runner, used after all the configuration repositories have been downloaded. Defaults to <code>.firestartr/apps</code></li><li><code>platform_folder_path</code>: path to the <code>platforms</code> folder to be used by the <code>make_dispatches</code> workflow. This is a path local to the runner, used after all the configuration repositories have been downloaded. Defaults to <code>.firestartr/platforms</code></li><li><code>registries_folder_path</code>: path to the <code>docker_registries</code> folder to be used by the <code>make_dispatches</code> workflow. This is a path local to the runner, used after all the configuration repositories have been downloaded. Defaults to <code>.firestartr/docker_registries</code></li></ul><p><strong>NOTE</strong>: <code>make_dispatches</code> downloads the <code>firestartr_config_repo</code> repository to access the configuration files via the <code>apps_folder_path</code>, <code>platform_folder_path</code> and <code>registries_folder_path</code> feature arguments. However, <code>firestartr_config_repo</code> is always downloaded under the <code>.firestartr</code> folder, regardless of what the actual name of the repository is, so the paths specified in the <code>*_folder_path</code> arguments should all start with <code>.firestartr/</code> (unless the folders are located in another repo)</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/docs/features/ class="flex align-center"><img src=/docs/icons/backward.svg class=book-icon alt=Backward>
<span>Features</span>
</a></span><span><a href=/docs/features/build_and_dispatch_docker_images/CHANGELOG/ class="flex align-center"><span>Changelog</span>
<img src=/docs/icons/forward.svg class=book-icon alt=Forward></a></span></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#build-images>Build images</a><ul><li></li></ul></li><li><a href=#make-dispatches>Make dispatches</a><ul><li></li></ul></li><li><a href=#feature-arguments>Feature arguments</a></li></ul></nav></div></aside></main></body></html>