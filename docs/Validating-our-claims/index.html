<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=' Go to the .firestartr repository and create the validations folder structure. More info here Inside the validations/policies folder, create the policy as a .rego file. You can learn more about Rego here Inside the apps/[app-name]/[claim-kind] folder create a YAML file as follows: name: my-validation description: "My validation description" regoFile: path/to_the/rego_file.rego applyTo: - app: sample-app data: data1: test-data1 data2: test-data2 ...Description of each field:
name: the name of the validation file, which must be unique between them. description: a brief description of what this validation does. Purely for human readability purpouses. regoFile: path to the rego file, relative to the policies folder (i.e., this field‚Äôs value will be concatenated to .firestartr/validations/policies like so: .firestartr/validations/policies/[this_fields_value]) applyTo: a list of conditions which describe to which claims this validation applies to. For this, for each value in each element of the list, an AND operation is done with each other value of that element, then for each element an OR operation is done against each other element. See ‚ÄúAbout the applyTo field values‚Äù to learn more about the possible values of this field. data: key-value pairs, where each key is a variable name and each name its value, to be used inside the regoFile file. ‚ùó About the applyTo field values# Each element of the applyTo field can have the following values:
'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://docs.firestartr.dev/docs/Validating-our-claims/"><meta property="og:site_name" content="Firestartr Documentation"><meta property="og:title" content="Firestartr Documentation"><meta property="og:description" content='Go to the .firestartr repository and create the validations folder structure. More info here Inside the validations/policies folder, create the policy as a .rego file. You can learn more about Rego here Inside the apps/[app-name]/[claim-kind] folder create a YAML file as follows: name: my-validation description: "My validation description" regoFile: path/to_the/rego_file.rego applyTo: - app: sample-app data: data1: test-data1 data2: test-data2 ...Description of each field:
name: the name of the validation file, which must be unique between them. description: a brief description of what this validation does. Purely for human readability purpouses. regoFile: path to the rego file, relative to the policies folder (i.e., this field‚Äôs value will be concatenated to .firestartr/validations/policies like so: .firestartr/validations/policies/[this_fields_value]) applyTo: a list of conditions which describe to which claims this validation applies to. For this, for each value in each element of the list, an AND operation is done with each other value of that element, then for each element an OR operation is done against each other element. See ‚ÄúAbout the applyTo field values‚Äù to learn more about the possible values of this field. data: key-value pairs, where each key is a variable name and each name its value, to be used inside the regoFile file. ‚ùó About the applyTo field values# Each element of the applyTo field can have the following values:'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta itemprop=name content="Firestartr Documentation"><meta itemprop=description content='Go to the .firestartr repository and create the validations folder structure. More info here Inside the validations/policies folder, create the policy as a .rego file. You can learn more about Rego here Inside the apps/[app-name]/[claim-kind] folder create a YAML file as follows: name: my-validation description: "My validation description" regoFile: path/to_the/rego_file.rego applyTo: - app: sample-app data: data1: test-data1 data2: test-data2 ...Description of each field:
name: the name of the validation file, which must be unique between them. description: a brief description of what this validation does. Purely for human readability purpouses. regoFile: path to the rego file, relative to the policies folder (i.e., this field‚Äôs value will be concatenated to .firestartr/validations/policies like so: .firestartr/validations/policies/[this_fields_value]) applyTo: a list of conditions which describe to which claims this validation applies to. For this, for each value in each element of the list, an AND operation is done with each other value of that element, then for each element an OR operation is done against each other element. See ‚ÄúAbout the applyTo field values‚Äù to learn more about the possible values of this field. data: key-value pairs, where each key is a variable name and each name its value, to be used inside the regoFile file. ‚ùó About the applyTo field values# Each element of the applyTo field can have the following values:'><meta itemprop=wordCount content="677"><title>Validating Our Claims | Firestartr Documentation</title><link rel=icon href=/docs/favicon.png><link rel=manifest href=/docs/manifest.json><link rel=canonical href=https://docs.firestartr.dev/docs/Validating-our-claims/><link rel=stylesheet href=/docs/book.min.cc2c524ed250aac81b23d1f4af87344917b325208841feca0968fe450f570575.css integrity="sha256-zCxSTtJQqsgbI9H0r4c0SRezJSCIQf7KCWj+RQ9XBXU=" crossorigin=anonymous><script defer src=/docs/fuse.min.js></script><script defer src=/docs/en.search.min.27ea268489c4afe5460ac64c12852404231f9abe51a238c074a89899891f1487.js integrity="sha256-J+omhInEr+VGCsZMEoUkBCMfmr5RojjAdKiYmYkfFIc=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-page"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/docs/><span>Firestartr Documentation</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/Migrating-to-our-new-app-state-repo-structure/>Migrating to Our New App State Repo Structure</a></li><li><input type=checkbox id=section-77ba58481c81cfcc87f14a72108199d0 class=toggle>
<label for=section-77ba58481c81cfcc87f14a72108199d0 class=flex><a href=/docs/providers/>Providers</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><input type=checkbox id=section-b1b6ec47a00c93e67ba6b7835cfc5cbb class=toggle>
<label for=section-b1b6ec47a00c93e67ba6b7835cfc5cbb class=flex><a href=/docs/providers/terraform/>Terraform</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/providers/terraform/workspace-policies/>Workspace Policies</a></li><li><a href=/docs/providers/terraform/workspace-sync/>Workspace Sync</a></li></ul></li></ul></li><li><a href=/docs/state-apps-repository/>State Apps Repository</a></li><li><a href=/docs/state-sys-services-repository/>State Sys Services Repository</a></li><li><a href=/docs/The-dot-firestartr-repository/>The Dot Firestartr Repository</a></li><li><a href=/docs/Validating-our-claims/ class=active>Validating Our Claims</a></li><li><input type=checkbox id=section-59625c6804349fe2bfba21980f88c1e3 class=toggle>
<label for=section-59625c6804349fe2bfba21980f88c1e3 class=flex><a href=/docs/features/>Features</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><input type=checkbox id=section-175a6acb21b23225ad6bb7d217c9122e class=toggle>
<label for=section-175a6acb21b23225ad6bb7d217c9122e class=flex><a href=/docs/features/build_and_dispatch_docker_images/>Build and Dispatch Docker Images</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/build_and_dispatch_docker_images/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-39ffb35bc31c80c3835fb6d107d8f566 class=toggle>
<label for=section-39ffb35bc31c80c3835fb6d107d8f566 class=flex><a href=/docs/features/catalog_repo/>Catalog Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/catalog_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-6b57e3023d9f976a9384af45ac1defa0 class=toggle>
<label for=section-6b57e3023d9f976a9384af45ac1defa0 class=flex><a href=/docs/features/charts_repo/>Charts Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/charts_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-b6a186066fe5df06a19368fd8c4e2996 class=toggle>
<label for=section-b6a186066fe5df06a19368fd8c4e2996 class=flex><a href=/docs/features/claims_repo/>Claims Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/claims_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-38807a9873b684081175bcfa2c2cf899 class=toggle>
<label for=section-38807a9873b684081175bcfa2c2cf899 class=flex><a href=/docs/features/features_repo/>Features Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/features_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-b095c0174f431275dbfbd179b858882c class=toggle>
<label for=section-b095c0174f431275dbfbd179b858882c class=flex><a href=/docs/features/firestartr_repo/>Firestartr Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/firestartr_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-8c74538169d2bfcc42048e94a7a8b10f class=toggle>
<label for=section-8c74538169d2bfcc42048e94a7a8b10f class=flex><a href=/docs/features/issue_templates/>Issue Templates</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/issue_templates/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-356bba00636a6fa9c561ac1523b4c383 class=toggle>
<label for=section-356bba00636a6fa9c561ac1523b4c383 class=flex><a href=/docs/features/release_please/>Release Please</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/release_please/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-17190a34986f329bfce42d3c100d77a8 class=toggle>
<label for=section-17190a34986f329bfce42d3c100d77a8 class=flex><a href=/docs/features/state_github/>State Github</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/state_github/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-5f9553708125dcb2260eaa1dc68fa4b3 class=toggle>
<label for=section-5f9553708125dcb2260eaa1dc68fa4b3 class=flex><a href=/docs/features/state_infra/>State Infra</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/state_infra/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-5cfdf617da323132dc220c8cdac15345 class=toggle>
<label for=section-5cfdf617da323132dc220c8cdac15345 class=flex><a href=/docs/features/state_repo/>State Repo</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/state_repo/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-ed9c88a7368e2738f3eb675492c08586 class=toggle>
<label for=section-ed9c88a7368e2738f3eb675492c08586 class=flex><a href=/docs/features/state_repo_apps/>State Repo Apps</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/state_repo_apps/KUBERNETES_README/>Kubernetes Readme</a></li><li><a href=/docs/features/state_repo_apps/SECRETS_README/>Secrets Readme</a></li><li><a href=/docs/features/state_repo_apps/TFWORKSPACES_README/>Tfworkspaces Readme</a></li><li><a href=/docs/features/state_repo_apps/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-9b5377154045b7f8613471f4d8281e78 class=toggle>
<label for=section-9b5377154045b7f8613471f4d8281e78 class=flex><a href=/docs/features/state_repo_sys_services/>State Repo Sys Services</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/state_repo_sys_services/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-36ec9bd0ed3955d6fa86995304f3f940 class=toggle>
<label for=section-36ec9bd0ed3955d6fa86995304f3f940 class=flex><a href=/docs/features/tech_docs/>Tech Docs</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/tech_docs/CHANGELOG/>Changelog</a></li></ul></li><li><input type=checkbox id=section-85da29a6eded009fe28c389b53dac15e class=toggle>
<label for=section-85da29a6eded009fe28c389b53dac15e class=flex><a href=/docs/features/terraform-infra/>Terraform Infra</a>
<img src=/docs/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/features/terraform-infra/ACCOUNTS_README/>Accounts Readme</a></li><li><a href=/docs/features/terraform-infra/CHANGELOG/>Changelog</a></li></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/docs/icons/menu.svg class=book-icon alt=Menu></label><h3>Validating Our Claims</h3><label for=toc-control><img src=/docs/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><ul><li><a href=#-example-of-the-applyto-field-criteria>‚ÄºÔ∏è Example of the applyTo field criteria</a></li><li><a href=#-test-your-validations-quickly>üß™ Test your validations quickly</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><ol><li>Go to the <code>.firestartr</code> repository and create the <code>validations</code> folder structure. More info <a href=/docs/The-dot-firestartr-repository/>here</a></li><li>Inside the <code>validations/policies</code> folder, create the policy as a <code>.rego</code> file. You can learn more about Rego <a href=https://www.openpolicyagent.org/docs/latest/policy-language/>here</a></li><li>Inside the <code>apps/[app-name]/[claim-kind]</code> folder create a YAML file as follows:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-validation</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;My validation description&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>regoFile</span>: <span style=color:#ae81ff>path/to_the/rego_file.rego</span>
</span></span><span style=display:flex><span><span style=color:#f92672>applyTo</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>app</span>: <span style=color:#ae81ff>sample-app</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>data1</span>: <span style=color:#ae81ff>test-data1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>data2</span>: <span style=color:#ae81ff>test-data2</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>...</span></span></span></code></pre></div><p>Description of each field:</p><ul><li><strong>name</strong>: the name of the validation file, which must be unique between them.</li><li><strong>description</strong>: a brief description of what this validation does. Purely for human readability purpouses.</li><li><strong>regoFile</strong>: path to the rego file, relative to the policies folder (i.e., this field&rsquo;s value will be concatenated to <code>.firestartr/validations/policies</code> like so: <code>.firestartr/validations/policies/[this_fields_value]</code>)</li><li><strong>applyTo</strong>: a list of conditions which describe to which claims this validation applies to. For this, for each value in each element of the list, an AND operation is done with each other value of that element, then for each element an OR operation is done against each other element. See <a href=#exclamation-about-the-applyto-field-values>&ldquo;About the applyTo field values&rdquo;</a> to learn more about the possible values of this field.</li><li><strong>data</strong>: key-value pairs, where each key is a variable name and each name its value, to be used inside the <code>regoFile</code> file.</li></ul><h1 id=-about-the-applyto-field-values>‚ùó About the applyTo field values<a class=anchor href=#-about-the-applyto-field-values>#</a></h1><p>Each element of the <code>applyTo</code> field can have the following values:</p><ul><li><em>App</em>: apply only to claims who will deploy to exactly the <code>app</code> with this value as its name</li><li><em>Name</em>: apply only to the claim with this value as its name (no two claims can have the same name as each other)</li><li><em>Kind</em>: apply only to the claims with this value as their kind</li><li><em>ResourceType</em>: apply only to the claims with this value as their ResourceType</li><li><em>Environment</em>: apply only to claims who will deploy to exactly the <code>env</code> with this value as its name</li><li><em>Tenant</em>: apply only to claims who will deploy to exactly the <code>tenant</code> with this value as its name</li><li><em>Platform</em>: apply only to claims who will deploy to exactly the <code>platform</code> with this value as its name</li></ul><h3 id=-example-of-the-applyto-field-criteria>‚ÄºÔ∏è Example of the applyTo field criteria<a class=anchor href=#-example-of-the-applyto-field-criteria>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>applyTo</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>app</span>: <span style=color:#ae81ff>app1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>TFWorkspace</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env</span>: <span style=color:#ae81ff>dev</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>kubernetes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>app2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env</span>: <span style=color:#ae81ff>pre</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-claim-1</span></span></span></code></pre></div><p>will be converted to:</p><p><code>(app == app1 && kind == TFWorkspace && env == dev) || (platform == kubernetes && app == app2 && env == pre) || (name == my-claim-1)</code></p><p>which means &ldquo;Apply this validation to:</p><p>the claim which deploys to the application <code>app1</code> AND the environment <code>dev</code> AND has the kind <code>TFWorkspace</code></p><p>OR</p><p>the claim which deploys to the platform <code>kubernetes</code> AND the application <code>app2</code> AND the environment <code>pre</code></p><p>OR</p><p>the claim with the name <code>my-claim-1</code>&rdquo;</p><h3 id=-test-your-validations-quickly>üß™ Test your validations quickly<a class=anchor href=#-test-your-validations-quickly>#</a></h3><ol><li>Create your data rule</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># my-data-rule.yaml</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;prefix-test-app&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Prefix all claim names with soups- in soups app&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>regoFile</span>: <span style=color:#ae81ff>claim_prefix_name.rego</span>
</span></span><span style=display:flex><span><span style=color:#f92672>applyTo</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>app</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>prefixName</span>: <span style=color:#ae81ff>test-</span></span></span></code></pre></div><ol start=2><li>Create your policy <code>.rego</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rego data-lang=rego><span style=display:flex><span><span style=color:#66d9ef>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>deny <span style=color:#66d9ef>contains</span> <span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>if</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>not</span> <span style=color:#a6e22e>startswith</span>(<span style=color:#a6e22e>input</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>data</span><span style=color:#f92672>.</span><span style=color:#a6e22e>data</span><span style=color:#f92672>.</span><span style=color:#a6e22e>prefixName</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>msg</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sprintf</span>(<span style=color:#e6db74>&#34;Claim name must start with &#39;%v&#39;, but got: &#39;%v&#39;&#34;</span><span style=color:#f92672>,</span> [<span style=color:#a6e22e>data</span><span style=color:#f92672>.</span><span style=color:#a6e22e>data</span><span style=color:#f92672>.</span><span style=color:#a6e22e>prefixName</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>input</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span>])
</span></span><span style=display:flex><span>}</span></span></code></pre></div><ol start=3><li>Create the claim</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># claim.yaml</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>TFWorkspaceClaim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>lifecycle</span>: <span style=color:#ae81ff>production</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-tenant-pre-vmss</span>
</span></span><span style=display:flex><span><span style=color:#f92672>resourceType</span>: <span style=color:#ae81ff>az-vmss</span>
</span></span><span style=display:flex><span><span style=color:#f92672>system</span>: <span style=color:#e6db74>&#34;system:test&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;1.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>providers</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>terraform</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>tfStateKey</span>: <span style=color:#ae81ff>e951e631-305a-414e-be4f-5562fc952122</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>policy</span>: <span style=color:#ae81ff>apply</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-tenant-pre-vmss</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>source</span>: <span style=color:#ae81ff>remote</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>module</span>: <span style=color:#ae81ff>git::https://github.com/test/tfm.git//modules/vmss-soups?ref=vmss-soups-v0.3.5</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>common</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>resource_group_name</span>: <span style=color:#e6db74>&#34;tenant-test-pre&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span>: <span style=color:#e6db74>&#34;westeurope&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>vmss</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;tenant-soup-pre&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>sku</span>: <span style=color:#e6db74>&#34;Standard_D2as_v5&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>instances</span>: <span style=color:#ae81ff>1</span></span></span></code></pre></div><ol start=3><li>Run docker command</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>echo <span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name: \&#34;prefix-test-app\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>description: \&#34;Prefix all claim names with soups- in soups app\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>regoFile: claim_prefix_name.rego
</span></span></span><span style=display:flex><span><span style=color:#e6db74>applyTo:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - app: test
</span></span></span><span style=display:flex><span><span style=color:#e6db74>data:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  prefixName: test-
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;</span> &gt; my-data-rule.yaml <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>package main
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>deny contains msg if {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    not startswith(input.name, data.data.prefixName)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    msg := sprintf(&#34;Claim name must start with &#39;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>&#39;%v&#39;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>&#39;, but got: &#39;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>&#39;%v&#39;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>&#39;&#34;, [data.data.prefixName, input.name])
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span> &gt; claim_prefix_name.rego <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: TFWorkspaceClaim
</span></span></span><span style=display:flex><span><span style=color:#e6db74>lifecycle: production
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name: test-tenant-pre-vmss
</span></span></span><span style=display:flex><span><span style=color:#e6db74>resourceType: az-vmss
</span></span></span><span style=display:flex><span><span style=color:#e6db74>system: &#34;system:test&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>version: &#34;1.0&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>providers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  terraform:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    tfStateKey: e951e631-305a-414e-be4f-5562fc952122
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    policy: apply
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: test-tenant-pre-vmss
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    source: remote
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    module: git::https://github.com/test/tfm.git//modules/vmss-soups?ref=vmss-soups-v0.3.5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    values:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      common:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        resource_group_name: &#34;corpme-soups-pre&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        location: &#34;westeurope&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      vmss:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        name: &#34;test-soup-pre&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sku: &#34;Standard_D2as_v5&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        instances: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span> &gt; claim.yaml <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run --rm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>/claim_prefix_name.rego:/validation/claim_prefix_name.rego <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>/my-data-rule.yaml:/validation/my-data-rule.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>/claim.yaml:/validation/claim.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -w /validation <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  openpolicyagent/conftest <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --rego-version v1 --output stdout test claim.yaml --data my-data-rule.yaml --policy claim_prefix_name.rego</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/docs/The-dot-firestartr-repository/ class="flex align-center"><img src=/docs/icons/backward.svg class=book-icon alt=Backward>
<span>The Dot Firestartr Repository</span>
</a></span><span><a href=/docs/features/ class="flex align-center"><span>Features</span>
<img src=/docs/icons/forward.svg class=book-icon alt=Forward></a></span></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#-example-of-the-applyto-field-criteria>‚ÄºÔ∏è Example of the applyTo field criteria</a></li><li><a href=#-test-your-validations-quickly>üß™ Test your validations quickly</a></li></ul></li></ul></nav></div></aside></main></body></html>